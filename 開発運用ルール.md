```
# 運用ルール.md

このドキュメントは、設計書に基づいて実装を進める際の「進め方・進捗管理・Git運用」を統一するためのルールです。  
**目的：設計と実装のズレを防ぎ、現在地が常に分かる状態で、区切りごとに安全にコミット＆pushすること。**

---

## 1. 前提
- 設計はユーザーが `設計書.md` として提示する（または本チャットで合意した内容を `設計書.md` として扱う）。
- 実装開始時点で `進捗.md` が無ければ作成する（リポジトリ直下）。
- `進捗.md` は **「pushしてよい区切り（=キリの良さ）」の証拠**として扱う。

---

## 2. 進捗.md の作成・更新ルール

### 2.1 初回作成（存在しない場合のみ）
- `設計書.md` を参照し、実装の順番（全体計画）を箇条書きで作る。

### 2.2 更新タイミング（重要）
- **原則：pushする前に必ず `進捗.md` を更新する。**
  - 更新は「完了したタスク」に **最低1行**追記するだけでよい。
- これにより「進捗.mdに記録されている＝キリの良い区切り」が保証される。

### 2.3 「キリの良い実装」の定義
以下のいずれかを満たす状態を「キリの良い実装」とする。
- 機能単位（例：1画面、1 API、1処理）が完了した
- ビルドが通り、主要動線が動作する
- TODOが残っていても影響範囲が限定的で、後続作業に支障がない

---

## 3. 進捗.md のフォーマット（固定）
`進捗.md` は以下の構成を **必ず維持**する。

```md
# 進捗
## 全体計画（設計書.md準拠）
1.
2.
3.
4.
・・・(必要に応じて増やす)
...

## 現在の立ち位置
- フェーズ：
- いまやっていること：
- 次にやること：

## 完了したタスク
- YYYY-MM-DD: （完了内容）
- YYYY-MM-DD: （完了内容）
・・・(必要に応じて増やす)

## バグ / エラー修正ログ
- YYYY-MM-DD: （タイトル）
  - 現象：  
  - 発生条件：  
  - 原因：  
  - 対策： 
  - 再発防止（任意）：  

## 未着手 / 保留
- （保留項目・理由・確認待ち）

## メモ / 課題
- （設計の不明点、気づき、リスク、改善提案など）
```
### 詳細ルール

* 「完了したタスク」「バグ / エラー修正ログ」は **上に新しいもの**を追記する（最新が先頭）。
* push前に最低1行、完了内容を追記する（短くてOK）。
* **バグ/エラー修正を含むpushの場合は**、必ず「バグ / エラー修正ログ」に追記する。

---

## 4. バグ修正・エラー修正の追記ルール（重要）

バグ修正（例外・クラッシュ・表示崩れ・処理失敗・性能劣化など）を行った場合は、`進捗.md` に以下を **分かりやすく簡単に**記録する。

* **現象**：ユーザー視点で何が起きたか（例：起動直後に落ちる、保存できない、画面が真っ白等）
* **発生条件**：いつ/どこで/どんな操作で発生するか（再現手順を短く）
* **対策**：どう直したか（方針と具体例を1〜2行で）
* （可能なら）**原因**：1行でよい（例：null参照、競合、境界値漏れ、スレッド違反など）

※ログは「詳細すぎない」こと。再現・理解・追跡ができる最小限を目指す。

---

## 5. 設計書.md と実装のズレ対応（重要）

実装中に `設計書.md` と矛盾・不足・不合理を発見した場合：

* ❌ 勝手に解釈して進めない（仕様を勝手に足す／削るの禁止）
* ✅ `進捗.md` の「メモ / 課題」に以下を記録する

  * 何が不足/矛盾しているか
  * 影響範囲（どこが困るか）
  * 変更提案（代替案がある場合）
* ✅ ユーザーに確認を求める or 設計書.md の修正案を提示する

---

## 6. 依存関係・ライブラリ追加ルール

* 新しいライブラリ/依存を追加する場合は、**理由を `進捗.md` に必ず記載**する。
* 可能なら「代替案（依存なしで実装できるか）」も併記する。
* 設計変更に相当する場合は、設計書.md の更新（または修正案提示）を行う。

---

## 7. Git運用ルール

### 7.1 コミット粒度

* 原則：**1コミット = 1目的**

  * UI変更、ロジック変更、リファクタ、バグ修正はできるだけ混在させない
* 大規模フォーマット変更、リネームのみ、依存更新のみ等は分離する

### 7.2 pushと進捗.mdの関係（最重要）

* **原則：pushする前に `進捗.md` を必ず更新する。**
* バグ/エラー修正を含む場合は、**「バグ / エラー修正ログ」も必ず更新する。**

### 7.3 例外（進捗.md無しでpush可）

以下の **“実質的な実装進捗が発生しない”**変更のみ例外とする。

* ドキュメントの誤字修正のみ
* コメント/整形のみ（挙動不変）
* 画像差し替え等の資産更新のみ（仕様不変）

※ただし、例外を使った場合でも、次の通常push時には進捗.mdを更新する。

---

## 8. コミット＆push（必須コマンド）

以下の PowerShell コマンドで **必ず** 実行する。
コミットメッセージは **行った内容を日本語で**記述する。

```powershell
if ((git status --porcelain).Length -eq 0) { "no changes" } else { git add -A; git commit -m "（ここに日本語のコミットメッセージ）"; git push }
```

### コミットメッセージ例

* `UI: 設定画面の基本レイアウトを追加`
* `機能: プレイリスト読み込み処理を実装`
* `修正: 再生停止後にクラッシュする問題を修正`
* `改善: 探索処理を非同期化して応答性を改善`

---

## 9. 推奨手順（毎回これ）

1. 実装（区切りまで）
2. `進捗.md` を更新（完了したタスクに最低1行）
3. バグ/エラー修正があれば「バグ / エラー修正ログ」も追記
4. `git status` で差分確認（意図しないファイルが混ざっていないか）
5. 既定コマンドで `commit & push`

---

## 10. 最終目標

* `進捗.md` を見れば「計画」「現在地」「完了」「保留」「課題」が即分かる状態を維持する。
* バグ修正は「何が起きたか／いつ起きたか／どう直したか」が追える状態にする。
* `設計書.md` と実装が常に整合し、ズレが出た場合は必ず記録・相談する。
* pushされる履歴は、必ず「進捗.mdで区切りが証明される」状態にする。